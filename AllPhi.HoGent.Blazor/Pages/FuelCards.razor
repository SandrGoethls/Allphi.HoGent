@page "/fuelcards"

@using AllPhi.HoGent.Blazor.Services
@using AllPhi.HoGent.Blazor.Dto
@using AllPhi.HoGent.Blazor.Components

@inject IFuelCardServices _fuelCardService
@inject IDriverServices _driverService
@inject IVehicleServices _vehicleService
@inject IFuelCardDriverServices _fuelCardDriverService
@inject IDriverVehicleServices _driverVehicleService

<PageTitle>FuelCards</PageTitle>


@if (_isLoading)
{
    <LoadingSpinner IsLoading="@_isLoading" />
}

@code {
    private bool _isLoading = true;

    private DriverListDto? _driverListDto;
    private FuelCardListDto? _fuelCardListDto;

    private int _pageNumber = 1;
    private int _pageSize = 5;
    private int _totalPages;
    private bool _isSortAscending = false;
    private string _currentSortColumn = "date";


    protected override async Task OnInitializedAsync()
    {
        await LoadFuelCardListDto();
        _driverListDto = await _driverService.GetAllDriversAsync();
        _isLoading = false;
    }

    private async Task LoadFuelCardListDto()
    {
        _fuelCardListDto = await _fuelCardService.GetAllFuelCardsAsync(_currentSortColumn, _isSortAscending, _pageNumber, _pageSize);
        _totalPages = (int)Math.Ceiling((double)_fuelCardListDto.TotalItems / _pageSize);
    }
}

